# Argo Rollouts Demo Deployment Guide

## Overview

This guide demonstrates how to deploy and verify a **Canary Rollout** using **Argo Rollouts** on a Kubernetes cluster.  
It includes deployment, service, and ingress configuration, along with verification steps and dashboard access instructions.

---

## Prerequisites

- Argo Rollouts controller is installed and running (see previous guide)
- `kubectl` and `kubectl-argo-rollouts` plugin installed
- NGINX Ingress Controller deployed
- DNS or `/etc/hosts` entry configured for your demo domain (e.g., `demorollouts.apsis.localnet`)

---

## 1. Create Rollout Deployment

File: **`demo-rollout-deployment.yaml`**

```yaml
apiVersion: argoproj.io/v1alpha1
kind: Rollout
metadata:
  name: rollouts-demo
spec:
  replicas: 5
  strategy:
    canary:
      steps:
      - setWeight: 10
      - pause: {}
      - setWeight: 20
      - pause: {}
      - setWeight: 30
      - pause: {}
      - setWeight: 40
      - pause: {}
      - setWeight: 50
      - pause: {duration: 60}
      - setWeight: 75
      - pause: {duration: 60}
  revisionHistoryLimit: 2
  selector:
    matchLabels:
      app: rollouts-demo
  template:
    metadata:
      labels:
        app: rollouts-demo
    spec:
      containers:
      - name: rollouts-demo
        image: argoproj/rollouts-demo:blue
        ports:
        - name: http
          containerPort: 8080
          protocol: TCP
        resources:
          requests:
            memory: 32Mi
            cpu: 5m
```

Apply the deployment:

```bash
kubectl apply -f demo-rollout-deployment.yaml
```

Verify rollout creation:

```bash
kubectl get rollout
kubectl argo rollouts get rollout rollouts-demo --watch
```

---

## 2. Create Service

File: **`demo-rollout-service.yaml`**

```yaml
apiVersion: v1
kind: Service
metadata:
  name: rollouts-demo
spec:
  ports:
  - port: 80
    targetPort: http
    protocol: TCP
    name: http
  selector:
    app: rollouts-demo
```

Apply the service:

```bash
kubectl apply -f demo-rollout-service.yaml
```

Check service status:

```bash
kubectl get svc rollouts-demo
```

---

## 3. Create Ingress

File: **`demo-rollout-ingress.yaml`**

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: demo-rollouts-ingress
  namespace: default
spec:
  ingressClassName: nginx
  rules:
    - host: demorollouts.apsis.localnet   # Change to your domain
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: rollouts-demo
                port:
                  number: 80
```

Apply the ingress configuration:

```bash
kubectl apply -f demo-rollout-ingress.yaml
```

Check ingress status:

```bash
kubectl get ingress demo-rollouts-ingress
```

---

## 4. Verify the Deployment

### Check Rollout Status
```bash
kubectl argo rollouts get rollout rollouts-demo
```

You should see details like:

```
Name:            rollouts-demo
Namespace:       default
Status:          ✔ Healthy
Strategy:        Canary
  Step:          12/12
  SetWeight:     100
  ActualWeight:  100
Images:          argoproj/rollouts-demo:blue (stable)
Replicas:
  Desired:       5
  Current:       5
  Updated:       5
  Ready:         5
  Available:     5

NAME                                       KIND        STATUS     AGE  INFO
⟳ rollouts-demo                            Rollout     ✔ Healthy  5s
└──# revision:1
   └──⧉ rollouts-demo-687d76d795           ReplicaSet  ✔ Healthy  4s   stable
      ├──□ rollouts-demo-687d76d795-44qdg  Pod         ✔ Running  4s   ready:1/1
      ├──□ rollouts-demo-687d76d795-kf7lb  Pod         ✔ Running  4s   ready:1/1
      ├──□ rollouts-demo-687d76d795-mw877  Pod         ✔ Running  4s   ready:1/1
      ├──□ rollouts-demo-687d76d795-nmppg  Pod         ✔ Running  4s   ready:1/1
      └──□ rollouts-demo-687d76d795-zrsdj  Pod         ✔ Running  4s   ready:1/1
```
You can also visualize it in real-time:
```bash
kubectl argo rollouts get rollout rollouts-demo --watch
```

---

## 5. Access the Demo Application

Once ingress is configured, open your browser and go to:

```
http://demorollouts.apsis.localnet
```
<img width="1650" height="676" alt="image" src="https://github.com/user-attachments/assets/00e2043f-02af-4d58-b135-2ae4c7772d34" />


If DNS is not configured, add an entry to `/etc/hosts` on your local machine:

```
<node_ip> demorollouts.apsis.localnet
```

Replace `<node_ip>` with your ingress controller’s external IP.

---

## 6. Access via Argo Rollouts Dashboard

If you have installed the dashboard earlier, you can view the rollout visually at:

```
http://argorollouts.apsis.localnet
```
<img width="1647" height="688" alt="image" src="https://github.com/user-attachments/assets/a6587634-da79-45cb-8d33-7202eb8b7c60" />


From there, navigate to the **rollouts-demo** rollout to see live traffic shifting and version progress.

---

## 7. Cleanup (Optional)

To remove all demo resources:

```bash
kubectl delete -f demo-rollout-deployment.yaml
kubectl delete -f demo-rollout-service.yaml
kubectl delete -f demo-rollout-ingress.yaml
```

---

## Summary

| Component | Description |
|------------|-------------|
| **Rollout** | Canary strategy deployment for gradual traffic shifting |
| **Service** | Internal Kubernetes service for the rollout app |
| **Ingress** | NGINX ingress for external access |
| **Dashboard** | UI for monitoring rollout progress |

---

## Reference Links

- [Argo Rollouts Documentation](https://argo-rollouts.readthedocs.io/)
- [Argo Rollouts GitHub](https://github.com/argoproj/argo-rollouts)
- [Canary Deployment Strategy Guide](https://argoproj.github.io/argo-rollouts/features/canary/)

---
Next: [Progressive Canary Deployment](https://github.com/jamaldevsecops/ArgoRollouts/blob/master/docs/3.Progressive-Canary-Deployment.md)  
Prev:  [Argo Rollouts Installation](https://github.com/jamaldevsecops/ArgoRollouts/blob/master/docs/1.Argo-Rollouts-Installation.md)

*Author: Jamal Hossain*  
*Date: 2025-10-10*  
