# Progressive Canary Deployment with Argo Rollouts

## 📘 Overview

This document provides step-by-step guidance for performing **Progressive Canary Deployments** using **Argo Rollouts**.  
You’ll learn how to promote a rollout using both **CLI** and the **Web UI Dashboard**, and how to verify the rollout behavior through the demo web application.

---

## 🧩 Prerequisites

Before starting, ensure the following are completed:

- Argo Rollouts Controller is installed and running in your Kubernetes cluster.  
- `kubectl argo rollouts` plugin is installed.  
- Argo Rollouts Dashboard is deployed and accessible via:  
  **http://argorollouts.apsis.localnet**
- Demo Rollout, Service, and Ingress are already applied and accessible via:  
  **http://demorollouts.apsis.localnet**

---

## 🚀 Step 1: Verify the Current Rollout Status

```bash
kubectl argo rollouts list rollouts
```

Example output:

```
NAME           STRATEGY   STATUS        STEP   SET-WEIGHT  READY  DESIRED  UP-TO-DATE  AVAILABLE
rollouts-demo  Canary     Healthy       12/12  100         5/5    5        5           5
```

To get detailed rollout information:

```bash
kubectl argo rollouts get rollout rollouts-demo
```

Example Output:

```
Name:            rollouts-demo
Namespace:       default
Status:          ✔ Healthy
Strategy:        Canary
  Step:          12/12
  SetWeight:     100
  ActualWeight:  100
Images:          argoproj/rollouts-demo:blue (stable)
Replicas:
  Desired:       5
  Current:       5
  Updated:       5
  Ready:         5
  Available:     5

NAME                                       KIND        STATUS     AGE  INFO
⟳ rollouts-demo                            Rollout     ✔ Healthy  58s
└──# revision:1
   └──⧉ rollouts-demo-687d76d795           ReplicaSet  ✔ Healthy  58s  stable
      ├──□ rollouts-demo-687d76d795-5r86l  Pod         ✔ Running  58s  ready:1/1
      ├──□ rollouts-demo-687d76d795-72xpv  Pod         ✔ Running  58s  ready:1/1
      ├──□ rollouts-demo-687d76d795-kf9t8  Pod         ✔ Running  58s  ready:1/1
      ├──□ rollouts-demo-687d76d795-wvtjc  Pod         ✔ Running  58s  ready:1/1
      └──□ rollouts-demo-687d76d795-zwmwj  Pod         ✔ Running  58s  ready:1/1
```

---

## 🧭 Step 2: Trigger an Update (Blue → Green)

Edit the image version in the rollout manifest:

```bash
kubectl argo rollouts set image rollouts-demo rollouts-demo=argoproj/rollouts-demo:green
```

Watch the rollout progress:

```bash
kubectl argo rollouts get rollout rollouts-demo --watch
```

The rollout will pause automatically at each defined step based on your `canary` configuration.

Example Output: 

```
Name:            rollouts-demo
Namespace:       default
Status:          ॥ Paused
Message:         CanaryPauseStep
Strategy:        Canary
  Step:          1/12
  SetWeight:     10
  ActualWeight:  16
Images:          argoproj/rollouts-demo:blue (stable)
                 argoproj/rollouts-demo:green (canary)
Replicas:
  Desired:       5
  Current:       6
  Updated:       1
  Ready:         6
  Available:     6

NAME                                       KIND        STATUS     AGE    INFO
⟳ rollouts-demo                            Rollout     ॥ Paused   4m47s
├──# revision:2
│  └──⧉ rollouts-demo-7d9c645dbb           ReplicaSet  ✔ Healthy  46s    canary
│     └──□ rollouts-demo-7d9c645dbb-hmrg7  Pod         ✔ Running  46s    ready:1/1
└──# revision:1
   └──⧉ rollouts-demo-687d76d795           ReplicaSet  ✔ Healthy  4m47s  stable
      ├──□ rollouts-demo-687d76d795-5r86l  Pod         ✔ Running  4m47s  ready:1/1
      ├──□ rollouts-demo-687d76d795-72xpv  Pod         ✔ Running  4m47s  ready:1/1
      ├──□ rollouts-demo-687d76d795-kf9t8  Pod         ✔ Running  4m47s  ready:1/1
      ├──□ rollouts-demo-687d76d795-wvtjc  Pod         ✔ Running  4m47s  ready:1/1
      └──□ rollouts-demo-687d76d795-zwmwj  Pod         ✔ Running  4m47s  ready:1/1
```
On Argo Rollouts UI: 
<img width="1647" height="688" alt="image" src="https://github.com/user-attachments/assets/a6587634-da79-45cb-8d33-7202eb8b7c60" />


On App UI: 
<img width="1645" height="680" alt="image" src="https://github.com/user-attachments/assets/58376b4c-7d99-4d12-bde6-1e7ccd6ac623" />

---

## 🧑‍💻 Step 3: Promote Canary via Command Line

When the rollout is paused, promote it manually:

```bash
kubectl argo rollouts promote rollouts-demo
```

### ✅ Verify the Promotion

Run:

```bash
kubectl argo rollouts get rollout rollouts-demo
```

Then, open **http://demorollouts.apsis.localnet** in your browser to confirm the **new (green)** version is being served.

- CLI rollout status (`kubectl argo rollouts get rollout rollouts-demo`)
  Example Output: 
  ```
  Name:            rollouts-demo
  Namespace:       default
  Status:          ॥ Paused
  Message:         CanaryPauseStep
  Strategy:        Canary
    Step:          3/12
    SetWeight:     20
    ActualWeight:  20
  Images:          argoproj/rollouts-demo:blue (stable)
                   argoproj/rollouts-demo:green (canary)
  Replicas:
    Desired:       5
    Current:       5
    Updated:       1
    Ready:         5
    Available:     5
  
  NAME                                       KIND        STATUS     AGE    INFO
  ⟳ rollouts-demo                            Rollout     ॥ Paused   11m
  ├──# revision:2
  │  └──⧉ rollouts-demo-7d9c645dbb           ReplicaSet  ✔ Healthy  7m20s  canary
  │     └──□ rollouts-demo-7d9c645dbb-hmrg7  Pod         ✔ Running  7m20s  ready:1/1
  └──# revision:1
     └──⧉ rollouts-demo-687d76d795           ReplicaSet  ✔ Healthy  11m    stable
        ├──□ rollouts-demo-687d76d795-5r86l  Pod         ✔ Running  11m    ready:1/1
        ├──□ rollouts-demo-687d76d795-kf9t8  Pod         ✔ Running  11m    ready:1/1
        ├──□ rollouts-demo-687d76d795-wvtjc  Pod         ✔ Running  11m    ready:1/1
        └──□ rollouts-demo-687d76d795-zwmwj  Pod         ✔ Running  11m    ready:1/1
  ```
- Web app output showing the updated version.
  Example Output:
  <img width="1633" height="682" alt="image" src="https://github.com/user-attachments/assets/93446429-47e5-401d-9696-7cfcc4515ae0" />

---

## 🖥️ Step 4: Promote Canary via Argo Rollouts Dashboard

1. Access **http://argorollouts.apsis.localnet**
2. Select the **rollouts-demo** rollout from the list.
3. Click **Promote** to proceed to the next canary step.

The UI will update in real time, reflecting the progress of the canary deployment.

### ✅ Verify the UI Promotion

After promotion:
- Visit **http://demorollouts.apsis.localnet**
- Confirm the version reflects the **new green** deployment.

On Argo Rollouts UI:
<img width="1645" height="687" alt="image" src="https://github.com/user-attachments/assets/5f398755-09f1-4a76-afcd-715b2ee0d843" />

On App UI: 
<img width="1643" height="679" alt="image" src="https://github.com/user-attachments/assets/aac3f525-7ee7-45cf-8fc5-24838746cc0b" />

---

## 🔍 Step 5: Monitor Rollout to Completion

Continue promoting the rollout until all steps are completed and status shows **✔ Healthy** with **SetWeight: 100**.

```bash
kubectl argo rollouts get rollout rollouts-demo
```

Example output:

```
Name:            rollouts-demo
Namespace:       default
Status:          ✔ Healthy
Strategy:        Canary
  Step:          12/12
  SetWeight:     100
  ActualWeight:  100
Images:          argoproj/rollouts-demo:green (stable)
Replicas:
  Desired:       5
  Current:       5
  Updated:       5
  Ready:         5
  Available:     5

NAME                                       KIND        STATUS        AGE    INFO
⟳ rollouts-demo                            Rollout     ✔ Healthy     19m
├──# revision:2
│  └──⧉ rollouts-demo-7d9c645dbb           ReplicaSet  ✔ Healthy     15m    stable
│     ├──□ rollouts-demo-7d9c645dbb-hmrg7  Pod         ✔ Running     15m    ready:1/1
│     ├──□ rollouts-demo-7d9c645dbb-v57lq  Pod         ✔ Running     6m11s  ready:1/1
│     ├──□ rollouts-demo-7d9c645dbb-95k7f  Pod         ✔ Running     3m19s  ready:1/1
│     ├──□ rollouts-demo-7d9c645dbb-6th8n  Pod         ✔ Running     2m48s  ready:1/1
│     └──□ rollouts-demo-7d9c645dbb-k4lz7  Pod         ✔ Running     117s   ready:1/1
└──# revision:1
   └──⧉ rollouts-demo-687d76d795           ReplicaSet  • ScaledDown  19m
```

---

## 🏁 Step 6: Validation

Visit **http://demorollouts.apsis.localnet** and verify that:
- The application is now running the **green** version.
- The rollout status in CLI and Dashboard are both **Healthy**.

---

## 📄 Summary

| Action | Method | Verification |
|--------|---------|--------------|
| Promote Canary | CLI | `kubectl argo rollouts get rollout rollouts-demo` |
| Promote Canary | Web UI | Argo Rollouts Dashboard |
| Verify Output | Browser | http://demorollouts.apsis.localnet |
| Monitor Rollout | CLI | `kubectl argo rollouts get rollout rollouts-demo --watch` |

---
Next:  
Prev: [Argo Rollouts Demo Deployment](https://github.com/jamaldevsecops/ArgoRollouts/blob/master/docs/2.Argo-Rollouts-Demo-Deployment.md)  
Next: [Control-Argo-Rollouts-Promote](https://github.com/jamaldevsecops/ArgoRollouts/blob/master/docs/4.Control-Argo-Rollouts-Promote.md)

*Author: Jamal Hossain*  
*Date: 2025-10-10*  
